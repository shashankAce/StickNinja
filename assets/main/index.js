window.__require=function t(e,i,s){function n(r,a){if(!i[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){return n(e[r][1][t]||t)},u,u.exports,t,e,i,s)}return i[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<s.length;r++)n(s[r]);return n}({BgManager:[function(t,e,i){"use strict";cc._RF.push(e,"5c94cgvINtPzoNt85aR7H8B","BgManager"),cc.Class({extends:cc.Component,properties:{bg1:cc.SpriteFrame,bg2:cc.SpriteFrame,bg3:cc.SpriteFrame,bg4:cc.SpriteFrame},ctor:function(){this.bgArr=[],this.speed=0,this.distToTravel=0},onLoad:function(){this.node.parent.getChildByName("sampleBg").active=!1;for(var t=1;t<3;){var e=new cc.Node("BG"+t);e.addComponent(cc.Sprite),e.parent=this.node,this.bgArr.push(e),t++}this.reset()},reset:function(){for(var t=Math.floor(3*Math.random()+1),e=0;e<this.bgArr.length;){var i=this.bgArr[e];i.getComponent(cc.Sprite).spriteFrame=this["bg"+t],i.x=i.width*e,e>0&&(i.scaleX=-1),e++}},update:function(t){if(this.distToTravel>0){var e=this.speed*t;this.bgArr[0].x-=e,this.bgArr[1].x-=e,this.bgArr[0].x+this.bgArr[0].width/2<-50&&(this.bgArr[0].x=this.bgArr[1].x+this.bgArr[1].width),this.bgArr[1].x+this.bgArr[1].width/2<-50&&(this.bgArr[1].x=this.bgArr[0].x+this.bgArr[0].width),this.distToTravel-=e}},scroll:function(t){var e=t/10;this.speed=e/.5,this.distToTravel=e}}),cc._RF.pop()},{}],SlugManager:[function(t,e,i){"use strict";cc._RF.push(e,"48709qsDthOkK8bGRC0kouC","SlugManager"),cc.Class({extends:cc.Component,properties:{animation:cc.Animation},onLoad:function(){this.isHit=!1,this.scale=.5,this.node.scale=this.scale,this.animation.getAnimationState("walk").wrapMode=cc.WrapMode.Normal},startPetroling:function(t,e){var i=this,s=e,n=parseInt(s/5),o=3,r=cc.tween().call(function(){++o,i.animation.play("walk"),i.node.scaleX=i.scale}).delay(.4).by(.2,{x:-s/n}).call(function(t){o>n/2?(o=0,r.stop(),cc.tween(i.node).then(a).start()):cc.tween(i.node).then(r).start()}),a=cc.tween().call(function(){i.animation.play("walk"),++o,i.node.scaleX=-i.scale}).delay(.4).by(.2,{x:s/n}).call(function(t){o>n/2?(o=0,a.stop(),cc.tween(i.node).then(r).start()):cc.tween(i.node).then(a).start()});cc.tween(this.node).then(r).start()}}),cc._RF.pop()},{}],Tutorial:[function(t,e,i){"use strict";cc._RF.push(e,"2d511breatFdIvbe56CZsYK","Tutorial"),cc.Class({extends:cc.Component,properties:{hand:cc.Node,arrow:cc.Node,msg:cc.Label,transparent:cc.Node},onLoad:function(){this.isTutorialShown=!1;var t=cc.sys.localStorage.getItem("StickNinjaTutShown");t&&"undefined"!=t?(this.isTutorialShown=!0,this.node.active=!1):(this.registerListener(),this.showTut())},registerListener:function(){var t=this;this.transparent.on(cc.Node.EventType.TOUCH_START,function(t,e){return!0},this,!0),this.transparent.on(cc.Node.EventType.TOUCH_END,function(e,i){1==t.isTutorialShown&&t.tutorialOver()},this,!0)},showTut:function(){this.node.active=!0,this.swipeUp()},swipeUp:function(){var t=this;this.msg.string="Jump",this.msg.node.setPosition(cc.v2(130,0)),this.hand.setPosition(cc.v2(0,0)),this.arrow.setPosition(cc.v2(0,130)),this.arrow.angle=-90,cc.tween(this.hand).delay(1).repeat(2,cc.tween().then(cc.tween().parallel(cc.tween().to(.7,{y:70}),cc.tween().to(.1,{scale:.8}))).then(cc.tween().parallel(cc.tween().to(.2,{scale:1}),cc.tween().to(1,{y:0})))).call(function(){t.swipeRight()}).start(),cc.tween(this.arrow).then(cc.tween().to(.5,{scale:1.1}).to(.5,{scale:1})).repeatForever().start(),cc.tween(this.msg.node).then(cc.tween().to(.5,{scale:1.1}).to(.5,{scale:1})).repeatForever().start()},swipeRight:function(){var t=this;this.msg.string="Attack",this.msg.node.setPosition(cc.v2(130,130)),this.hand.setPosition(cc.v2(-100,0)),this.arrow.setPosition(cc.v2(100,0)),this.arrow.angle=180,cc.tween(this.hand).delay(1).repeat(2,cc.tween().then(cc.tween().parallel(cc.tween().to(.7,{x:0}),cc.tween().to(.1,{scale:.8}))).then(cc.tween().parallel(cc.tween().to(1,{x:-100}),cc.tween().to(.2,{scale:1})))).call(function(){t.tapHold()}).start()},tapHold:function(){var t=this,e="",i="Tap Hold to\nadd stick",s=0;this.msg.string=" ",this.schedule(function t(){s<i.length?(e+=i[s],this.msg.string=e):(this.isTutorialShown=!0,this.unschedule(t)),s++},.1),this.msg.node.setPosition(cc.v2(0,0)),this.hand.setPosition(cc.v2(0,-70)),this.arrow.stopAllActions(),this.arrow.active=!1,cc.tween(this.hand).repeat(4,cc.tween().then(cc.tween().to(.5,{scale:.7}).delay(.7).to(.5,{scale:1}))).call(function(){t.tutorialOver()}).start()},tutorialOver:function(){this.hand.stopAllActions(),this.msg.node.stopAllActions(),this.arrow.stopAllActions(),cc.sys.localStorage.setItem("StickNinjaTutShown",!0),this.node.active=!1}}),cc._RF.pop()},{}],constants:[function(t,e,i){"use strict";cc._RF.push(e,"ea104SI6ltKgJ2qn3ku2SLg","constants");e.exports={state:{IDLE:1,RUNNING:2,FALLING:3,JUMPING:4},treasure:{type:{GOLD:10,GEM_BLUE:11,GEM_GREEN:12,GEM_RED:13,STAR:14,HEART:15,KNIFE:16},value:{GOLD:5,GEM_BLUE:10,GEM_GREEN:15,GEM_RED:20,STAR:50,HEART:0,KNIFE:0},quantity:{GOLD:3,GEM_BLUE:2,GEM_GREEN:2,GEM_RED:1,STAR:1}},obstacles:{COINS:20,SLUG:100,ENEMY:2},touchTimeoutCount:10},cc._RF.pop()},{}],enemy:[function(t,e,i){"use strict";cc._RF.push(e,"11f0a8hl2pLr60dRaSd0ePQ","enemy");var s=t("./constants");cc.Class({extends:cc.Component,ctor:function(){this.isHit=!1},onLoad:function(){this.node.setScale(-.25,.25),this.animation=this.node.getComponent(cc.Animation),this.fncToCall=null,this.state=s.state.IDLE,this.isHit=!1},stopAllTween:function(){this.node.stopAllActions()},setState:function(t){this.state=t},onAttackAnimComplete:function(){this.idle(),this.state!=s.state.RUNNING&&(this.fncToCall&&this.fncToCall(),this.fncToCall=null)},idle:function(){this.animation.play("idle")},run:function(){this.animation.play("run")},attack:function(t){this.fncToCall=t,this.animation.play("attack")}}),cc._RF.pop()},{"./constants":"constants"}],gameOver:[function(t,e,i){"use strict";cc._RF.push(e,"3d6b6qt+6pF+rPoIhMAfUwP","gameOver"),cc.Class({extends:cc.Component,properties:{score:cc.Node,playAgain:cc.Node,backHome:cc.Node},onLoad:function(){},updateScore:function(){var t=cc.sys.localStorage.getItem("NinjaScore"),e=cc.sys.localStorage.getItem("NinjaBestScore");this.score.getComponent(cc.Label).string="Score\n"+t+"\nBest\n"+e;var i=this.node.parent.getChildByName("MainCamera");cc.tween(i).by(.1,{y:-10}).by(.1,{y:10}).by(.1,{y:-10}).by(.1,{y:10}).start()},onPlayAgain:function(){this.node.parent.getComponent("main").restartGame()},onBackHome:function(){}}),cc._RF.pop()},{}],heroManager:[function(t,e,i){"use strict";cc._RF.push(e,"87c30gElEhJyIvcTzkdXcfT","heroManager");var s=t("./constants");cc.Class({extends:cc.Component,properties:{animation:cc.Animation},ctor:function(){this.state=s.state.IDLE,this.pendingAction=null,this.lastPosX=0,this.previousState=this.state},stopAllTween:function(){this.node.stopAllActions()},setState:function(t){this.previousState=this.state,this.state=t},onLoad:function(){this.node.scale=.3,this.animation.play("idle")},idle:function(){this.animation.play("idle")},jump:function(){this.animation.play("jump")},run:function(){this.animation.play("run")},die:function(){this.animation.play("die")},attack:function(){this.animation.playAdditive("attack")},afterAttack:function(){}}),cc._RF.pop()},{"./constants":"constants"}],hudManager:[function(t,e,i){"use strict";var s;cc._RF.push(e,"fedc3a8oY1P9IwzIbDFiDfH","hudManager"),cc.Class(((s={extends:cc.Component,properties:{enemy:cc.Node,enemyBlack:cc.Node,knifeContainer:cc.Node,lifeContainer:cc.Node,bestScore:cc.Label},ctor:function(){this.lifeScale=.4,this.enemyWaitCount=100,this.tweenActive=!1},onLoad:function(){this.enemyProgress=this.enemyBlack.getComponent(cc.ProgressBar),this.lifeArr=this.lifeContainer.children,this.knifeArr=this.knifeContainer.children,this.lifeArr.sort(),this.knifeArr.sort(),this.reset(),this.show(!1)},reset:function(){this.lifeCount=this.lifeArr.length,this.knifeCount=this.knifeArr.length;var t=cc.sys.localStorage.getItem("NinjaBestScore");this.bestScore.string=t||0,this.updateLifeUI(),this.updateKnifeUI()},resetEnemyWait:function(t){this.enemyWaitCount=t,this.setEnemyProgress(t)},show:function(t){this.lifeContainer.active=t,this.knifeContainer.active=t,this.enemy.active=t,this.enemyBlack.active=t},setEnemyProgress:function(t){var e=t/this.enemyWaitCount;e<=0&&(e=0),this.enemyProgress.progress=e,0==e?this.tweenActive||this.highlightEnemy(!0):this.tweenActive&&this.highlightEnemy(!1)},highlightEnemy:function(t){t?(this.tweenActive=!0,cc.tween(this.enemy).then(cc.tween().to(.5,{scale:.6}).to(.5,{scale:.5})).repeatForever().start()):(this.tweenActive=!1,this.enemy.scale=.5,this.enemy.stopAllActions())},getKnifeCount:function(){return this.knifeCount},getLifeCount:function(){return this.lifeCount},setHighScore:function(){var t=parseInt(cc.sys.localStorage.getItem("NinjaScore"));cc.sys.localStorage.getItem("NinjaBestScore")?parseInt(cc.sys.localStorage.getItem("NinjaBestScore"))<t&&cc.sys.localStorage.setItem("NinjaBestScore",t):cc.sys.localStorage.setItem("NinjaBestScore",t);this.bestScore.string=cc.sys.localStorage.getItem("NinjaBestScore")},addKnife:function(){this.knifeCount<3&&++this.knifeCount,this.updateKnifeUI()},removeKnife:function(){--this.knifeCount,this.knifeCount<0&&(this.knifeCount=0),this.updateKnifeUI()},addLife:function(){this.lifeCount<3&&++this.lifeCount,this.updateLifeUI()},removeLife:function(){--this.lifeCount,this.lifeCount<0&&(this.lifeCount=0),this.updateLifeUI()}}).addLife=function(){++this.lifeCount,this.updateLifeUI()},s.updateLifeUI=function(){for(var t=0;t<this.lifeArr.length;t++){var e=this.lifeArr[t];t>=this.lifeCount?e.active=!1:e.active=!0}},s.updateKnifeUI=function(){for(var t=0;t<this.knifeArr.length;t++){var e=this.knifeArr[t];t>=this.knifeCount?e.active=!1:e.active=!0}},s)),cc._RF.pop()},{}],main:[function(t,e,i){"use strict";cc._RF.push(e,"9a44dGKGjlIbb6WNrPe6Ujx","main");var s=t("./constants"),n=t("./touchListener");cc.Class({extends:n,properties:{gameLabel:cc.Node,begin:cc.Node,pipe1:cc.Node,pipe2:cc.Node,stick:cc.Node,stick2:cc.Node,heroNode:cc.Node,bgNode:cc.Node,hud:cc.Node,scoreBox:cc.Node,scoreText:cc.Node,bonus:cc.Node,gameOverNode:cc.Node,treasure:cc.Prefab,treasureBonus:cc.Prefab,sword:cc.SpriteFrame,shuriken:cc.Prefab,enemyNode:cc.Prefab,slug:cc.Prefab},ctor:function(){this.level=1,this.pipeHeight=184,this.heroPosY=-185,this.scrollTime=.5,this.stickTweenTime=2,this.heroSpeed=300,this.heroScrollPos=40,this.stickLengthThreshold=10,this.bonusAmount=5,this.goldValue=7,this.diamondValue=10,this.treasurePosition=cc.v2(0,-50),this.pipeArray=[],this.treasureArray=[],this.treasureScrollDist=160,this.pipeBonusY=-175,this.pipeOutLoc=cc.winSize.width/2+50,this.maxLife=3,this.maxKnife=3,this.weaponSpeed=1,this.weaponArray=[],this.enemy=null,this.slugArray=[],this.funcToCall=null,this.swordObj={},this.knifeCount=0,this.throwing=!1,this.enemyWait=0},reset:function(){this._super(),this.touchEnabled=!1,this.stickAdded=!1,this.stickDropped=!1,this.beginPressed=!1,this.gameStarted=!1,this.isGameOver=!1,this.tweenCount=0,this.stickTween=null,this.stick.scale=1,this.stick.width=0,this.stick.active=!1,this.stick2.scale=1,this.stick2.width=0,this.stick2.active=!1,this.gameOverNode.active=!1,this.heroNode.angle=0,this.hero.state=s.state.IDLE,this.throwing=!1,this.stick.stopAllActions()},resetScore:function(){this.score=0,this.level=1,this.scoreBox.active=!1,this.scoreText.active=!1,this.scoreText.getComponent(cc.Label).string=this.score},resetHud:function(){this.scoreBox.active=!0,this.scoreText.active=!0,this.enemyWait=s.obstacles.ENEMY,this.hudManager.reset(),this.hudManager.resetEnemyWait(this.enemyWait),this.hudManager.show(!0)},resetEnemy:function(){this.enemy&&(this.enemy.node.destroy(),this.enemy=null)},resetWeapons:function(){if(this.weaponArray.length)for(var t=0;t<this.weaponArray.length;t++){this.weaponArray[t].destroy()}this.weaponArray=[]},resetTreasure:function(){if(this.treasureArray.length)for(var t=0;t<this.treasureArray.length;t++){this.treasureArray[t].destroy()}this.treasureArray=[]},onLoad:function(){this.hero=this.heroNode.getComponent("heroManager"),this.hudManager=this.hud.getComponent("hudManager"),this.reset(),this.resetScore(),this.resetGravity(),this.audio=this.node.getComponent("music"),this.audio.playBgMusic(),this.background=this.bgNode.getComponent("BgManager"),this.bonus.active=!1;var t=cc.v2(-this.gameLabel.width/2,300);this.gameLabel.position=t;var e=cc.v2(0,this.begin.position.y),i=this.begin.getComponent(cc.Graphics);i.fillColor=(new cc.Color).fromHEX("#f08080"),i.circle(0,0,50),i.fill();var s="sineOut",n=cc.tween().to(1.5,{position:cc.v2(e.x,e.y-10)},{easing:s}).to(1.5,{position:cc.v2(e.x,e.y+10)},{easing:s});this.beginTween=cc.tween(this.begin).then(n).repeatForever().start(),this.hero.node.position=cc.v2(0,this.heroPosY),this.pipeArray.push(this.pipe1),this.pipeArray.push(this.pipe2),this.initPipes(),this.initListener(this.node)},resetMap:function(){this.background.reset()},initPipes:function(){for(var t=0;t<this.pipeArray.length;t++){var e=this.pipeArray[t];if(t<1){var i=e.getComponent(cc.Graphics);i.clear(),i.rect(0,0,65,this.pipeHeight),i.fill(),e.graphicWidth=65,e.position=cc.v2(-32.5,-cc.winSize.height/2),e.getChildByName("redMark").active=!1}else{var s=this.getRandPipeWidth(),n=e.getComponent(cc.Graphics);n.clear(),n.rect(0,0,s,this.pipeHeight),n.fill(),e.graphicWidth=s,e.position=cc.v2(cc.winSize.width/2+10,-cc.winSize.height/2),e.getChildByName("redMark").setPosition(cc.v2(s/2,this.pipeHeight))}}},onBeginClick:function(){var t=this;if(!this.beginPressed){this.beginPressed=!0,this.audio.playGong();var e=cc.tween().to(.9,{angle:-60},{easing:"elasticOut"});cc.tween(this.gameLabel).then(e).call(function(){t.removeIntro()}).start()}},removeIntro:function(){var t=this,e=cc.tween().to(.7,{y:-400},{easing:"quartIn"});cc.tween(this.gameLabel).then(e).start(),this.beginTween.stop();var i=cc.tween().to(.7,{position:cc.v2(this.begin.position.x,1e3)},{easing:"quartIn"});cc.tween(this.begin).then(i).call(function(){t.initGame()}).start()},initGame:function(){var t,e=this;this.hero.node.x=0;for(var i=0;i<this.pipeArray.length;i++){var s=this.pipeArray[i];if(0==i){t=s.position;var n=cc.tween().to(this.scrollTime,{x:-cc.winSize.width/2},{easing:"sineOut"});cc.tween(s).then(n).start()}else{var o=cc.tween().to(this.scrollTime,{x:this.getRandomPipeLocation()},{easing:"sineOut"});cc.tween(s).then(o).start()}}var r=t.x- -cc.winSize.width/2,a=this.hero.node.position.x-r,c=cc.tween().to(this.scrollTime,{x:a,y:this.heroPosY},{easing:"sineOut"});cc.tween(this.hero.node).then(c).delay(.2).call(function(){e.resetHud(),e.startGame()}).start()},respawnHero:function(){var t,e=this;this.hero.node.x=0;for(var i=0;i<this.pipeArray.length;i++){var s=this.pipeArray[i];if(0==i){t=s.position;var n=cc.tween().to(this.scrollTime,{x:-cc.winSize.width/2},{easing:"sineOut"});cc.tween(s).then(n).start()}else{var o=cc.tween().to(this.scrollTime,{x:this.getRandomPipeLocation()},{easing:"sineOut"});cc.tween(s).then(o).start()}}var r=t.x- -cc.winSize.width/2,a=this.hero.node.position.x-r,c=cc.tween().to(this.scrollTime,{x:a,y:this.heroPosY},{easing:"sineOut"});cc.tween(this.hero.node).then(c).delay(.2).call(function(){e.startGame()}).start()},startGame:function(){this.gameStarted=!0,this.touchEnabled=!0},restartGame:function(){cc.log("Game Restarted"),this.reset(),this.resetGravity(),this.resetScore(),this.resetEnemy(),this.resetHud(),this.resetWeapons(),this.resetTreasure(),this.initPipes(),this.initGame(),this.resetMap(),this.audio.playClick(),this.audio.playBgMusic()},spawnAgain:function(){cc.log("Spawn Again"),this.reset(),this.resetGravity(),this.resetEnemy(),this.resetWeapons(),this.resetTreasure(),this.initPipes(),this.respawnHero()},addStick:function(){if(!this.stickAdded&&this.hero.state!=s.state.FALLING&&this.hero.state!=s.state.JUMPING&&!this.isGameOver){cc.log("Adding Stick"),this.stick.active=!0,this.stick.angle=90,this.stick.width=0;var t=this.pipeArray[0];this.stick.position=cc.v2(t.position.x+t.graphicWidth,-this.pipeHeight),this.stickTween=cc.tween(this.stick).then(cc.tween().to(this.stickTweenTime,{width:cc.winSize.width}).call(function(t){t.width=0})).repeatForever().start(),this.stickAdded=!0,this.stickDropped=!1}},dropStick:function(){var t=this;if(this.stickAdded&&!this.stickDropped&&this.hero.state!=s.state.FALLING){cc.log("Dropping Stick"),this.stickDropped=!0;this.stickTween.stop(),this.stick.width>this.stickLengthThreshold?cc.tween(this.stick).to(.7,{angle:0},{easing:"quadIn"}).call(function(){if(!t.isGameOver){var e=t.pipeArray[1],i=e.position.x+e.graphicWidth/2-5,s=t.stick.position.x+t.stick.width;s>=i&&s<=i+10&&t.addBonus(),t.hero.lastPosX=t.hero.node.x,t.screenShake(),t.audio.playStickLanded(),t.heroRun()}}).start():(this.stick.width=0,this.stick.active=!1,this.stickAdded=!1)}},heroRun:function(){var t=this;if(this.hero.state!=s.state.JUMPING){this.hero.setState(s.state.RUNNING);var e=this.stick.position.x+this.stick.width,i=(e-this.hero.node.x)/this.heroSpeed;cc.tween(this.hero.node).to(i,{x:e},{progress:function(e,i,n,o){if(t.enemy&&t.enemy.state!=s.state.RUNNING){var r=i-t.hero.lastPosX;100-parseInt((i-n)/r*100)>20&&t.hideEnemy()}return e+(i-e)*o}}).call(function(){t.heroStopped()}).start(),this.hero.run()}else this.hero.pendingAction="RUN"},heroStopped:function(){this.hero.setState(s.state.IDLE),this.checkFall()},heroJump:function(){this.isGameOver||this.hero.state!=s.state.FALLING&&this.hero.state!=s.state.JUMPING&&(cc.log("Jumping"),this.hero.state==s.state.RUNNING&&(this.hero.pendingAction="RUN",this.hero.stopAllTween()),this.hero.setState(s.state.JUMPING),this.audio.playJump(),this.hero.jump(),this.vy=-this.mvy)},heroAttack:function(){if(!this.isGameOver&&!(this.throwing||this.hudManager.getKnifeCount()<1)){cc.log("Attacking"),this.throwing=!0,this.audio.playKnifeThrow();var t=new cc.Node("talwar"),e=t.addComponent(cc.Sprite);t.parent=this.node,e.spriteFrame=this.sword,t.x=this.hero.node.x+20,t.y=this.hero.node.y+40,this.knifeCount++,t.uid=this.knifeCount,t.hit=!1,this.swordObj[this.knifeCount]=t,this.hero.attack(),cc.tween(t).to(this.weaponSpeed,{x:cc.winSize.width+t.width}).start(),this.hudManager.removeKnife()}},heroLanded:function(){(this.hero.setState(s.state.IDLE),this.hero.idle(),"RUN"==this.hero.pendingAction)&&(this.hero.pendingAction=null,this.stick.position.x+this.stick.width-this.hero.node.x>0&&this.heroRun())},heroHit:function(t){var e=this,i=this.weaponArray.indexOf(t);i>-1&&this.weaponArray.splice(i,1),t.destroy(),this.hero.state!=s.state.FALLING&&(this.audio.playHit(),this.hero.idle(),this.hero.stopAllTween(),this.hero.setState(s.state.FALLING),this.isGameOver=!0,this.vy=0,cc.tween(this.hero.node).to(.5,{y:-cc.winSize.height/2-100,angle:80}).call(function(){e.gameOver()}).start())},enemyHit:function(){var t=this;this.enemyWait=this.getRandomBetween(100,30),this.hudManager.resetEnemyWait(this.enemyWait),this.enemy.state!=s.state.RUNNING&&this.enemy.state!=s.state.FALLING&&(this.audio.playHit(),this.enemy.idle(),this.enemy.stopAllTween(),this.enemy.setState(s.state.FALLING),cc.tween(this.enemy.node).to(.5,{y:-cc.winSize.height/2-100,angle:-80}).call(function(e){e.destroy(),t.enemy=null}).start())},checkFall:function(){var t=this;if(this.hero.state!=s.state.FALLING){var e=this.pipeArray[1];this.hero.node.position.x>e.position.x+e.graphicWidth||this.hero.node.position.x<e.position.x?(this.audio.playFall(),this.touchEnabled=!1,this.hero.setState(s.state.FALLING),this.isGameOver=!0,this.vy=0,cc.tween(this.hero.node).to(.5,{y:-cc.winSize.height/2-100}).call(function(){t.gameOver()}).start(),this.hero.idle()):(this.increaseScore(),this.scrollWorld(),this.stick.width=0,this.hero.idle())}},gameOver:function(){this.hudManager.removeLife(),this.hudManager.getLifeCount()>0?this.spawnAgain():(cc.sys.localStorage.setItem("NinjaScore",this.score),this.hudManager.setHighScore(),this.touchEnabled=!1,this.gameStarted=!1,this.isGameOver=!0,this.scoreBox.active=!1,this.scoreText.active=!1,this.gameOverNode.active=!0,this.gameOverNode.getComponent("gameOver").updateScore(),this.audio.stopBgMusic(),this.audio.playGameOver(),this.hudManager.show(!1),this.resetEnemy(),this.resetWeapons(),this.resetTreasure())},getAllowedEnemyLimit:function(){var t=0;return this.level>4?t=-10:this.level>6?t=-20:this.level>8?t=-30:this.level>10&&(t=-50),t},scrollWorld:function(){var t=this;this.tweenCount=0,this.touchEnabled=!1;var e=this.pipeArray[0],i=this.getRandomPipeLocation(),s=cc.tween().to(this.scrollTime/2,{x:-cc.winSize.width/2-e.graphicWidth}).call(function(){e.x=t.pipeOutLoc,t.changePipeSize(e),i>t.getAllowedEnemyLimit()&&t.spawnEnemy(i)}).to(this.scrollTime/2,{x:i},{easing:"sineOut"}),n=this.pipeArray[1],o=-cc.winSize.width/2+this.heroScrollPos,r=this.hero.node.position.x-o,a=n.position.x-r,c=cc.tween().to(this.scrollTime,{x:a},{easing:"sineOut"}),h=cc.tween().to(this.scrollTime,{x:o},{easing:"sineOut"});cc.tween(e).then(s).call(function(){t.transposePipes()}).start(),cc.tween(n).then(c).call(function(){t.transposePipes()}).start(),cc.tween(this.hero.node).then(h).delay(.1).call(function(){t.transposePipes()}).start(),this.background.scroll(r),this.spawnCoins(i)},transposePipes:function(){if(++this.tweenCount,3===this.tweenCount){var t=this.pipeArray[0];this.pipeArray[0]=this.pipeArray[1],this.pipeArray[1]=t,this.stickAdded=!1,this.touchEnabled=!0}},changePipeSize:function(t){var e=t.getComponent(cc.Graphics),i=this.getRandPipeWidth();e.clear(),e.rect(0,0,i,this.pipeHeight),e.fill(),t.graphicWidth=i;var s=t.getChildByName("redMark");s.active=!0,s.setPosition(cc.v2(i/2,this.pipeHeight))},spawnCoins:function(){var t=this;if(!(s.obstacles.COINS>this.score)){var e=0,i=this.getRandomBetween(2,0);if(this.treasureArray.length&&(e=this.treasureArray[this.treasureArray.length-1].x),i>0&&this.treasureArray.length<3&&e<cc.winSize.width/4)for(var n=this.getTreasure(),o=1;o<=n.quantity;o++){var r=cc.instantiate(this.treasure);this.node.addChild(r);var a=r.getComponent("treasure");a.setFrame(n.type),a.startTween(500*o),r.setPosition(cc.v2(cc.winSize.width/2+32*o,this.treasurePosition.y)),this.treasureArray.push(r)}for(var c=0;c<this.treasureArray.length;c++){var h=this.treasureArray[c];cc.tween(h).by(this.scrollTime,{x:-this.treasureScrollDist},{easing:"sineOut"}).call(function(){t.removeTreasure()}).start()}}},removeTreasure:function(){for(var t=0;t<this.treasureArray.length;t++){var e=this.treasureArray[t];(e.x<-cc.winSize.width/2||e.isHit)&&(this.treasureArray.splice(t,1),e.destroy(),--t)}},getTreasure:function(){var t=[];this.score<100?(t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GEM_BLUE)):this.score<200?(t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GEM_GREEN),t.push(s.treasure.type.GEM_BLUE)):this.score<300?(t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GEM_RED),t.push(s.treasure.type.GEM_GREEN),t.push(s.treasure.type.GEM_BLUE)):(t.push(s.treasure.type.STAR),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GOLD),t.push(s.treasure.type.GEM_RED),t.push(s.treasure.type.GEM_RED),t.push(s.treasure.type.GEM_GREEN),t.push(s.treasure.type.GEM_GREEN),t.push(s.treasure.type.GEM_BLUE),t.push(s.treasure.type.GEM_BLUE));var e=this.getHelpArrayCount();if(!this.treasureArray.find(function(t){return t.getComponent("treasure").getType()==s.treasure.type.KNIFE})&&this.hudManager.getKnifeCount()<this.maxKnife)for(var i=0;i<e;i++)t.push(s.treasure.type.KNIFE);if(!this.treasureArray.find(function(t){return t.getComponent("treasure").getType()==s.treasure.type.HEART})&&this.hudManager.getLifeCount()<this.maxLife)for(var n=0;n<3*e;n++)t.push(s.treasure.type.HEART);t=this.shuffle(t);var o=1,r=Math.floor(Math.random()*t.length);return t[r]==s.treasure.type.GOLD?o=this.rand(s.treasure.quantity.GOLD):t[r]==s.treasure.type.GEM_GREEN||t[r]==s.treasure.type.GEM_BLUE?o=this.rand(2):t[r]==s.treasure.type.GEM_RED?o=1:t[r]==s.treasure.type.STAR?o=1:t[r]==s.treasure.type.HEART?o=1:t[r]==s.treasure.type.KNIFE&&(o=1),{type:t[r],quantity:o}},shuffle:function(t){for(var e,i=t.length;0!==i;){e=Math.floor(Math.random()*i),i--;var s=[t[e],t[i]];t[i]=s[0],t[e]=s[1]}return t},getHelpArrayCount:function(){return this.level>1?4:this.level>2?3:this.level>3?2:this.level>4?1:void 0},rand:function(t,e){return Math.floor(Math.random()*t)+1},hideEnemy:function(){var t=this;if(this.enemy&&this.enemy.state!=s.state.RUNNING&&this.enemy.state!=s.state.FALLING){var e=this.pipeArray[1].x+this.pipeArray[1].graphicWidth+20-this.enemy.node.x;this.enemy.stopAllTween(),this.enemy.node.scaleX=-this.enemy.node.scaleX,this.enemy.state=s.state.RUNNING,this.enemy.run(),cc.tween(this.enemy.node).by(.3,{x:e}).call(function(t){t.getComponent("enemy").idle()}).by(.5,{y:-200}).call(function(e){e.destroy(),t.enemy=null}).start()}},spawnEnemy:function(t){var e=this;if(!(this.enemyWait>0)){var i=1;this.hudManager.getKnifeCount()>0&&(i=.25),this.resetEnemy();var n=cc.instantiate(this.enemyNode);this.node.addChild(n),this.enemy=n.getComponent("enemy"),this.enemy.state=s.state.IDLE,n.position=cc.v2(this.pipeOutLoc+20,this.heroPosY);var o=cc.tween().to(this.scrollTime/2,{x:t+20},{easing:"sineOut"}),r=cc.tween().call(function(){e.isGameOver?r.stop():n.getComponent("enemy").attack(function(){e.audio.playKnifeThrow();var t=cc.instantiate(e.shuriken);t.scale=.3,e.node.addChild(t),t.position=cc.v2(n.position.x-10,n.position.y+30),e.weaponArray.push(t),cc.tween(t).to(e.weaponSpeed,{x:-cc.winSize.width/2-100}).call(function(t){if(!e.isGameOver){var s=e.weaponArray.indexOf(t);s>-1&&e.weaponArray.splice(s,1),t.destroy(),i=e.hudManager.getKnifeCount()>0?0:1,cc.tween(n).delay(i).then(r).start()}}).start()})});cc.tween(n).then(o).delay(i).then(r).start()}},spawnSlug:function(t,e){var i=cc.instantiate(this.slug);this.node.addChild(i);var s=i.getComponent("SlugManager");this.slugArray.push(s),i.position=cc.v2(this.pipeOutLoc+e/2,this.heroPosY);var n=cc.tween().to(this.scrollTime/2,{x:t+e/2},{easing:"sineOut"});cc.tween(i).then(n).call(function(i){i.getComponent("SlugManager").startPetroling(t,e)}).start()},removeSlug:function(){for(var t=0;t<this.slugArray.length;t++){var e=this.slugArray[t];(e.node.x<-cc.winSize.width/2||e.isHit)&&(this.slugArray.splice(t,1),e.node.destroy(),--t)}},setScore:function(){this.scoreText.getComponent(cc.Label).string=this.score,this.hudManager.setEnemyProgress(this.enemyWait),this.level=Math.floor(this.score/100)+1},increaseScore:function(){++this.score,this.enemyWait-=1,this.setScore()},addBonus:function(){var t=this,e=this.pipeArray[1],i=e.position.x+e.graphicWidth/2+5;this.bonus.opacity=255,this.bonus.setPosition(cc.v2(i,this.pipeBonusY)),this.bonus.getComponent(cc.Label).string=this.bonusAmount+"+",this.bonus.active=!0,this.score+=this.bonusAmount,this.enemyWait-=this.bonusAmount,this.setScore(),cc.tween(this.bonus).by(.5,{y:20}).call(function(){t.bonus.active=!1}).start(),cc.tween(this.bonus).to(.5,{opacity:0}).start(),this.audio.playBonus()},addTreasureBonus:function(t){var e=t.getComponent("treasure");if(e.getType()==s.treasure.type.HEART)return this.hudManager.addLife(),void this.audio.playGem();if(e.getType()==s.treasure.type.KNIFE)return this.hudManager.addKnife(),void this.audio.playCoin();e.getType()==s.treasure.type.GOLD?this.audio.playCoin():this.audio.playGem();var i=cc.instantiate(this.treasureBonus);this.node.addChild(i);var n=e.getValue();i.setPosition(cc.v2(t.position.x,t.position.y+20)),i.getComponent(cc.Label).string=n+"+",cc.tween(i).by(.5,{y:30}).call(function(t){t.destroy()}).start(),cc.tween(i).to(.5,{opacity:0}).start(),this.score+=n,this.enemyWait-=n,this.setScore()},screenShake:function(){var t=this.node.getChildByName("MainCamera");cc.tween(t).by(.1,{y:2}).by(.1,{y:-2}).start()},getRandomPipeLocation:function(){return Math.floor(131*Math.random()-50)},getRandomBetween:function(t,e){return Math.floor(Math.random()*(t-e+1)+e)},getRandPipeWidth:function(){var t=50;return this.level>1?t=40:this.level>4?t=35:this.level>8?t=30:this.level>10&&(t=25),Math.floor(Math.random()*(70-t+1)+t)},onTouchBegan:function(t,e){this._super(t,e),this.gameStarted&&this.touchEnabled&&(this.throwing=!1,this.stickAdded||(cc.log("TouchBegan"),this.resetTouchTimeout(),this.schedule(this.updateTimeout,.01)))},updateTimeout:function(){this.touchHoldPrevented||(this.touchTimeoutCount--,this.touchTimeoutCount<=0&&(this.touchHoldPrevented=!1,this.unschedule(this.updateTimeout),this.addStick()))},onTouchEnded:function(t,e){this.gameStarted&&this.touchEnabled&&(this.touchHoldPrevented=!1,this.unschedule(this.updateTimeout),this.dropStick())},onTouchMoved:function(t,e){this._super(t,e),this.gameStarted&&this.touchEnabled&&(this.isSwipeUp||this.isSwipeRight)&&(this.isSwipeRight&&this.heroAttack(),this.isSwipeUp&&this.hero.state!=s.state.JUMPING&&this.heroJump(),this.touchHoldPrevented=!0,this.dropStick()),this.resetSwipe()},resetGravity:function(){this.cy=0,this.dt=.4,this.vy=0,this.mvy=20,this.gravity=.98,this.collision=!1},findCollision:function(){for(var t=!1,e=this.hero.node.getBoundingBox(),i=0;i<this.treasureArray.length;i++){var s=this.treasureArray[i].getBoundingBox();e.intersects(s)&&(this.treasureArray[i].isHit=!0,this.addTreasureBonus(this.treasureArray[i]),t=!0)}t&&(this.removeTreasure(),t=!1);for(var n in this.swordObj){var o=this.swordObj[n];this.enemy&&this.enemy.node.getBoundingBox().intersects(o.getBoundingBox())&&(o.hit=!0,this.enemy.isHit=!0,this.enemyHit()),(o.x>cc.winSize.width||o.hit)&&(delete this.swordObj[o.uid],o.destroy())}for(var r=0;r<this.weaponArray.length;r++){var a=this.weaponArray[r];e.intersects(a.getBoundingBox())&&this.heroHit(a)}},update:function(){this.gameStarted&&(this.cy-=this.vy*this.dt,this.heroPosY+this.cy>this.heroPosY?(this.hero.node.y=this.heroPosY+this.cy,this.vy<=this.mvy&&(this.vy+=this.gravity)):this.hero.state==s.state.JUMPING&&(this.heroLanded(),this.hero.node.y=this.heroPosY,this.vy=0),this.findCollision())}}),cc._RF.pop()},{"./constants":"constants","./touchListener":"touchListener"}],music:[function(t,e,i){"use strict";cc._RF.push(e,"68a3cMvntFLpqdvhTqC8gn2","music"),cc.Class({extends:cc.Component,properties:{bgm:cc.AudioClip,gong:cc.AudioClip,jump:cc.AudioClip,throw:cc.AudioClip,wood:cc.AudioClip,bonus:cc.AudioClip,click:cc.AudioClip,gameOver:cc.AudioClip,coin:cc.AudioClip,gem:cc.AudioClip,bodyHit:cc.AudioClip,fall:cc.AudioClip},onLoad:function(){this.isMusicPlaying=!1},playBgMusic:function(){this.isMusicPlaying?cc.audioEngine.resumeMusic():(cc.audioEngine.playMusic(this.bgm,!0),cc.audioEngine.setMusicVolume(1)),this.isMusicPlaying=!0},stopBgMusic:function(){cc.audioEngine.pauseMusic()},playBonus:function(){cc.audioEngine.playEffect(this.bonus,!1)},playCoin:function(){cc.audioEngine.playEffect(this.coin,!1)},playGem:function(){cc.audioEngine.playEffect(this.gem,!1)},playGong:function(){cc.audioEngine.playEffect(this.gong,!1)},playClick:function(){cc.audioEngine.playEffect(this.click,!1)},playJump:function(){cc.audioEngine.playEffect(this.jump,!1)},playKnifeThrow:function(){cc.audioEngine.playEffect(this.throw,!1)},playStickLanded:function(){cc.audioEngine.play(this.wood,!1,.3)},playGameOver:function(){cc.audioEngine.play(this.gameOver,!1,1)},playHit:function(){cc.audioEngine.playEffect(this.bodyHit,!1)},playDead:function(){cc.audioEngine.playEffect(this.bodyHit,!1)},playFall:function(){cc.audioEngine.playEffect(this.fall,!1)}}),cc._RF.pop()},{}],touchListener:[function(t,e,i){"use strict";cc._RF.push(e,"6c45cJ1AbND6KFW3dIXMaLm","touchListener");var s=t("./constants");cc.Class({extends:cc.Component,ctor:function(){this.time=new Date,this.touchStartPoint=cc.v2(0,0),this.touchLastPoint=cc.v2(0,0),this.moveThreshold=50,this.resetTouchTimeout(),this.resetSwipe()},reset:function(){this.resetSwipe(),this.resetTouchTimeout()},resetTouchTimeout:function(){this.touchTimeoutCount=s.touchTimeoutCount,this.touchHoldPrevented=!1},resetSwipe:function(){this.isSwipeUp=!1,this.isSwipeDown=!1,this.isSwipeLeft=!1,this.isSwipeRight=!1},initListener:function(t){t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this,!0),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this,!0),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this,!0)},onTouchBegan:function(t,e){var i=t.getLocation();this.touchStartPoint=cc.v2(i.x,i.y),this.touchLastPoint=cc.v2(i.x,i.y),this.resetSwipe()},onTouchMoved:function(t,e){var i=t.getLocation(),s=this.touchStartPoint;this.onMoveActionHandler(i,s)},onMoveActionHandler:function(t,e){t.x<e.x-this.moveThreshold&&(t.x>this.touchLastPoint.x?(e=this.touchStartPoint=cc.v2(t.x,t.y),this.isSwipeLeft=!1):this.isSwipeLeft=!0),t.x>e.x+this.moveThreshold&&(t.x<this.touchLastPoint.x?(this.touchStartPoint=cc.v2(t.x,t.y),this.isSwipeRight=!1):this.isSwipeRight=!0),t.y>e.y+this.moveThreshold&&(t.y<this.touchLastPoint.y?(this.touchStartPoint=cc.v2(t.x,t.y),this.isSwipeUp=!1):this.isSwipeUp=!0),t.y<e.y-this.moveThreshold&&(t.y>this.touchLastPoint.y?(this.touchStartPoint=cc.v2(t.x,t.y),this.isSwipeDown=!1):this.isSwipeDown=!0),this.touchLastPoint=cc.v2(t.x,t.y)},onTouchEnded:function(t,e){t.getLocation()}}),cc._RF.pop()},{"./constants":"constants"}],treasure:[function(t,e,i){"use strict";cc._RF.push(e,"8200088y3VPqp9YPAv20f64","treasure");var s=t("./constants");cc.Class({extends:cc.Component,properties:{gold:cc.SpriteFrame,star:cc.SpriteFrame,heart:cc.SpriteFrame,gemRed:cc.SpriteFrame,gemBlue:cc.SpriteFrame,gemGreen:cc.SpriteFrame,knife:cc.SpriteFrame},onLoad:function(){this.treasureValue=0,this.upTweenBy=20,this.isHit=!1,this.type=0,this.active=!1,this.node.scale=.4},setFrame:function(t){switch(this.type=t,t){case s.treasure.type.GOLD:this.treasureValue=s.treasure.value.GOLD,this.getComponent(cc.Sprite).spriteFrame=this.gold,this.node.scale=.4;break;case s.treasure.type.GEM_BLUE:this.treasureValue=s.treasure.value.GEM_BLUE,this.getComponent(cc.Sprite).spriteFrame=this.gemBlue,this.node.scale=.3;break;case s.treasure.type.GEM_GREEN:this.treasureValue=s.treasure.value.GEM_GREEN,this.getComponent(cc.Sprite).spriteFrame=this.gemGreen,this.node.scale=.3;break;case s.treasure.type.GEM_RED:this.treasureValue=s.treasure.value.GEM_RED,this.getComponent(cc.Sprite).spriteFrame=this.gemRed,this.node.scale=.3;break;case s.treasure.type.STAR:this.treasureValue=s.treasure.value.STAR,this.getComponent(cc.Sprite).spriteFrame=this.star,this.node.scale=.3;break;case s.treasure.type.HEART:this.treasureValue=s.treasure.value.HEART,this.getComponent(cc.Sprite).spriteFrame=this.heart,this.node.scale=.4;break;case s.treasure.type.KNIFE:this.treasureValue=s.treasure.value.KNIFE,this.getComponent(cc.Sprite).spriteFrame=this.knife,this.node.angle=90,this.node.scale=.6;break;default:cc.log("Frame Type Not found for Treasure")}},getRandomBetween:function(t,e){return Math.floor(Math.random()*(t-e+1)+e)},startTween:function(t){t/=1e3,this.moveTween=cc.tween(this.node).delay(t).then(cc.tween().by(1,{y:-this.upTweenBy},{easing:"sineOut"}).by(1,{y:this.upTweenBy},{easing:"sineOut"})).repeatForever().start()},stopTween:function(){this.moveTween.stop()},getValue:function(){return this.treasureValue},getType:function(){return this.type}}),cc._RF.pop()},{"./constants":"constants"}]},{},["BgManager","SlugManager","Tutorial","constants","enemy","gameOver","heroManager","hudManager","main","music","touchListener","treasure"]);